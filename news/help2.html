<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>News Docs</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <script>
  const username = localStorage.getItem("username");

  if (username) {
    console.log("verfied....")
  } else {

    window.location.href = "main.html";
    
    
  }
</script>

  <header class="header">
    <h1>News Docs</h1>
    <p>Please read below on how to make a ad.</p>
  </header>

  <main class="container">
    <div class="card">
      <h2>Ad setup.</h2>
      <p>
        You must setup the colors, text, and design for your ad.
        The price for one ad is $1
      </p>
      <p>
        You must pay on the date you choose.

        DO not choose invalid dates.
      </p>
      
    </div>
    <p>                 </p>
    <p>                 </p>
    <div class="card">
  <h2>Create an Ad</h2>

  <!-- Date input -->
  <label for="ad-date">Ad Date (Weekdays only) THIS IS THE DAY YOU PAY FOR THE AD, NOT THE DAY THE AD IS SHOWN.</label>
  <input type="date" id="ad-date">

  <!-- Ad text -->
  <label for="ad-text">Ad Text</label>
  <textarea
    id="ad-text"
    rows="4"
    placeholder="Enter your ad text here..."
  ></textarea>

  <!-- Color picker -->
  <label for="ad-color">Text Color</label>
  <input type="color" id="ad-color" value="#000000">

  <!-- Price display -->
  <p class="price">Price for ad: <strong>$1</strong></p>

  <!-- Error message -->
  <div id="ad-error" class="error"></div>

  <!-- Create button -->
  <button class="button" onclick="createAd()">Create</button>
</div>
     
  </main>

  <footer class="footer">
    © 2026 My Website
  </footer>

  <script>
const API_URL = "https://api.jsonsilo.com/public/4e001ae2-2fec-4537-8dbb-ccfa6fe3aab1";
const API_KEY = "YOUR_API_KEY_HERE"; // remove if not required

async function createAd() {
  const dateInput = document.getElementById("ad-date").value;
  const text = document.getElementById("ad-text").value.trim();
  const color = document.getElementById("ad-color").value;
  const error = document.getElementById("ad-error");

  error.textContent = "";

  if (!dateInput) {
    error.textContent = "Please select a date.";
    return;
  }

  const selectedDate = new Date(dateInput);
  const day = selectedDate.getDay(); // 0 = Sunday, 6 = Saturday

  if (day === 0 || day === 6) {
    error.textContent = "Weekends are not allowed. Choose a workday.";
    return;
  }

  if (!text) {
    error.textContent = "Ad text cannot be empty.";
    return;
  }

  // Build ad object
  const newAd = {
    date: dateInput,
    text: text,
    color: color,
    price: 1
  };

  try {
    // 1. GET existing data
    const getRes = await fetch(API_URL, {
      headers: {
        "Content-Type": "application/json",
        "Authorization": API_KEY
      }
    });

    if (!getRes.ok) throw new Error("Failed to fetch ads");

    const data = await getRes.json();

    // Ensure ads array exists
    if (!Array.isArray(data.ads)) {
      data.ads = [];
    }

    // 2. Add new ad
    data.ads.push(newAd);

    // 3. PUT updated data
    const putRes = await fetch(API_URL, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        "Authorization": API_KEY
      },
      body: JSON.stringify(data)
    });

    if (!putRes.ok) throw new Error("Failed to save ad");

    alert("✅ Ad successfully created and saved!");

    // Optional reset
    document.getElementById("ad-text").value = "";
  } catch (err) {
    console.error(err);
    error.textContent = "Error saving ad. Please try again.";
  }
}
</script>

</body>
</html>
